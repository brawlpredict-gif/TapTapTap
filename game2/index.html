<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width,
initial-scale=1.0,
maximum-scale=1.0,
user-scalable=no,
viewport-fit=cover">
<title>Tomato Jump</title>

<style>
html,body{
margin:0;
padding:0;
overflow:hidden;
background:#87CEEB;
touch-action:none;
font-family:Arial;

/* üî• –û–¢–ö–õ–Æ–ß–ê–ï–ú –í–´–î–ï–õ–ï–ù–ò–ï */
user-select:none;
-webkit-user-select:none;
-webkit-touch-callout:none;
-webkit-tap-highlight-color:transparent;
}

canvas{
display:block;
user-select:none;
-webkit-user-select:none;
}

#score{
position:fixed;
top:15px;
left:15px;
font-size:22px;
color:white;
font-weight:bold;
z-index:10;
pointer-events:none; /* –Ω–µ–ª—å–∑—è –≤—ã–¥–µ–ª–∏—Ç—å */
}

#controls{
position:fixed;
bottom:20px;
left:0;
width:100%;
display:flex;
justify-content:space-between;
padding:0 30px;
box-sizing:border-box;
z-index:10;
}

.btn{
width:90px;
height:90px;
border-radius:50%;
border:none;
background:rgba(0,0,0,0.35);
color:white;
font-size:36px;

user-select:none;
-webkit-user-select:none;
-webkit-tap-highlight-color:transparent;
}

.btn:active{
background:rgba(0,0,0,0.6);
}
</style>
</head>

<body>

<div id="score">0</div>
<canvas id="game"></canvas>

<div id="controls">
<button class="btn" id="left">‚Üê</button>
<button class="btn" id="right">‚Üí</button>
</div>

<audio id="music" loop>
<source src="music.mp3">
</audio>

<script>

// üî• –î–û–ü. –ë–õ–û–ö–ò–†–û–í–ö–ê –í–´–î–ï–õ–ï–ù–ò–Ø
document.addEventListener("selectstart", e => e.preventDefault())
document.addEventListener("gesturestart", e => e.preventDefault())

const canvas = document.getElementById("game")
const ctx = canvas.getContext("2d")

function resize(){
canvas.width = window.innerWidth
canvas.height = window.innerHeight
}
resize()
window.addEventListener("resize", resize)

const imgFall = new Image()
imgFall.src="player_fall.png"

const imgJump = new Image()
imgJump.src="player_jump.png"

let currentImg = imgFall

// ===== –§–ò–ó–ò–ö–ê (–ú–ï–î–õ–ï–ù–ù–ï–ï –ü–†–´–ñ–û–ö) =====
const GRAVITY = 0.22        // –±—ã–ª–æ 0.28
const JUMP_FORCE = -7       // –±—ã–ª–æ -8.5
const MOVE_SPEED = 4.5
const MAX_FALL_SPEED = 10   // –±—ã–ª–æ 12

let player
let platforms = []
let score = 0
let difficulty = 1
let gameRunning = true

function createPlayer(){
player = {
width:60,
height:75,
x:canvas.width/2-30,
y:canvas.height-200,
vx:0,
vy:0
}
}

function createPlatforms(){
platforms = []
let count = 12
let spacing = canvas.height / count

for(let i=0;i<count;i++){
platforms.push({
x:Math.random()*(canvas.width-90),
y:i*spacing,
width:90,
height:18,
type:"normal",
vx:0,
broken:false,
hasSpring:false
})
}
}

function resetGame(){
score=0
difficulty=1
createPlayer()
createPlatforms()
gameRunning=true
}

let left=false
let right=false

document.getElementById("left").ontouchstart=()=>left=true
document.getElementById("left").ontouchend=()=>left=false
document.getElementById("right").ontouchstart=()=>right=true
document.getElementById("right").ontouchend=()=>right=false

document.addEventListener("keydown",e=>{
if(e.key=="ArrowLeft") left=true
if(e.key=="ArrowRight") right=true
})
document.addEventListener("keyup",e=>{
if(e.key=="ArrowLeft") left=false
if(e.key=="ArrowRight") right=false
})

document.body.addEventListener("touchstart",()=>{
document.getElementById("music").play()
},{once:true})

function update(){

if(!gameRunning) return

if(left) player.vx=-MOVE_SPEED
else if(right) player.vx=MOVE_SPEED
else player.vx=0

player.x+=player.vx

if(player.x<-player.width) player.x=canvas.width
if(player.x>canvas.width) player.x=-player.width

player.vy+=GRAVITY
if(player.vy>MAX_FALL_SPEED) player.vy=MAX_FALL_SPEED
player.y+=player.vy

currentImg = player.vy < 0 ? imgJump : imgFall

if(player.vy>0){
for(let i=0;i<platforms.length;i++){
let p=platforms[i]
if(p.broken) continue

if(
player.x+player.width>p.x &&
player.x<p.x+p.width &&
player.y+player.height>p.y &&
player.y+player.height<p.y+p.height
){
if(p.type==="break"){
p.broken=true
}else{
player.vy = p.hasSpring ? JUMP_FORCE*1.6 : JUMP_FORCE
}
}
}
}

if(player.y<canvas.height*0.4){
let diff=canvas.height*0.4-player.y
player.y=canvas.height*0.4

for(let i=0;i<platforms.length;i++){
platforms[i].y+=diff
}

score+=Math.floor(diff)
difficulty=1+score/4000
}

for(let i=0;i<platforms.length;i++){
let p=platforms[i]

if(p.type==="move"){
p.x+=p.vx
if(p.x<0||p.x+p.width>canvas.width){
p.vx*=-1
}
}

if(p.y>canvas.height){

p.y=-20
p.x=Math.random()*(canvas.width-p.width)

let breakChance=Math.min(0.25,score/6000)
let moveChance=Math.min(0.2,score/6000)
let springChance=Math.min(0.15,score/8000)

let r=Math.random()

if(r<breakChance){
p.type="break"
}
else if(r<breakChance+moveChance){
p.type="move"
p.vx=(Math.random()<0.5?-1:1)*(1+difficulty*0.2)
}
else{
p.type="normal"
}

p.broken=false
p.hasSpring=(Math.random()<springChance)
}
}

if(player.y>canvas.height){
gameRunning=false
setTimeout(resetGame,500)
}

}

function draw(){

ctx.clearRect(0,0,canvas.width,canvas.height)

ctx.drawImage(currentImg,player.x,player.y,player.width,player.height)

for(let i=0;i<platforms.length;i++){
let p=platforms[i]
if(p.broken) continue

if(p.type==="break") ctx.fillStyle="#e74c3c"
else if(p.type==="move") ctx.fillStyle="#f1c40f"
else ctx.fillStyle="#2ecc71"

ctx.fillRect(p.x,p.y,p.width,p.height)

if(p.hasSpring){
ctx.fillStyle="white"
ctx.fillRect(p.x+p.width/2-5,p.y-10,10,10)
}
}

document.getElementById("score").innerText=score
}

function loop(){
update()
draw()
requestAnimationFrame(loop)
}

resetGame()
loop()

</script>
</body>
</html>
